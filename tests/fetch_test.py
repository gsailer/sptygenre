import mock
import pytest
import sptygenre.fetch.fetch as fetch


@pytest.fixture
def spotipyAPI():
    m = mock.MagicMock()
    m.user_playlist.return_value = {'collaborative': False, 'description': None, 'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db/playlist/3UVCafpPe8O9Nn47A6D363'}, 'followers': {'href': None, 'total': 0}, 'href': 'https://api.spotify.com/v1/users/g051x7db/playlists/3UVCafpPe8O9Nn47A6D363', 'id': '3UVCafpPe8O9Nn47A6D363', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/bf3561a432a4ceac784c5f9dfd551c0de4d29a94', 'width': 640}], 'name': 'test_playlist', 'owner': {'display_name': None, 'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db'}, 'href': 'https://api.spotify.com/v1/users/g051x7db', 'id': 'g051x7db', 'type': 'user', 'uri': 'spotify:user:g051x7db'}, 'public': True, 'snapshot_id': 'GD0hSZPTJ/sviwvbcx6CTTV8P3R83E+rTuIZLzvoPpc+eYkGRCjibRV+yUFkqV90', 'tracks': {'href': 'https://api.spotify.com/v1/users/g051x7db/playlists/3UVCafpPe8O9Nn47A6D363/tracks?offset=0&limit=100', 'items': [{'added_at': '2018-02-02T15:42:29Z', 'added_by': {'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db'}, 'href': 'https://api.spotify.com/v1/users/g051x7db', 'id': 'g051x7db', 'type': 'user', 'uri': 'spotify:user:g051x7db'}, 'is_local': False, 'track': {'album': {'album_type': 'single', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/1XKjtpH5P81gpOXDB91IEB'}, 'href': 'https://api.spotify.com/v1/artists/1XKjtpH5P81gpOXDB91IEB', 'id': '1XKjtpH5P81gpOXDB91IEB', 'name': 'Miami Yacine', 'type': 'artist', 'uri': 'spotify:artist:1XKjtpH5P81gpOXDB91IEB'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'external_urls': {'spotify': 'https://open.spotify.com/album/40CYJrASNrMCDr2x4UE60E'}, 'href': 'https://api.spotify.com/v1/albums/40CYJrASNrMCDr2x4UE60E', 'id': '40CYJrASNrMCDr2x4UE60E', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/bf3561a432a4ceac784c5f9dfd551c0de4d29a94', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/ee3625453f33e989380a67d0a25299840fdcde8a', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/93b12946028a5a172008f5c2f25e2dcd3bc61e48', 'width': 64}], 'name': 'Kokaina', 'type': 'album', 'uri': 'spotify:album:40CYJrASNrMCDr2x4UE60E'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/1XKjtpH5P81gpOXDB91IEB'}, 'href': 'https://api.spotify.com/v1/artists/1XKjtpH5P81gpOXDB91IEB', 'id': '1XKjtpH5P81gpOXDB91IEB', 'name': 'Miami Yacine', 'type': 'artist', 'uri': 'spotify:artist:1XKjtpH5P81gpOXDB91IEB'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'disc_number': 1, 'duration_ms': 201979, 'explicit': True, 'external_ids': {'isrc': 'DELJ81616750'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/2KHbPYI22yWIOgWUsApYIS'}, 'href': 'https://api.spotify.com/v1/tracks/2KHbPYI22yWIOgWUsApYIS', 'id': '2KHbPYI22yWIOgWUsApYIS', 'name': 'Kokaina', 'popularity': 68, 'preview_url': 'https://p.scdn.co/mp3-preview/f06860acc59525ee6758536914c7b07001f1470d?cid=3dab3c84034247168f7021f1f1128754', 'track_number': 1, 'type': 'track', 'uri': 'spotify:track:2KHbPYI22yWIOgWUsApYIS'}}, {'added_at': '2018-02-02T15:42:33Z', 'added_by': {'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db'}, 'href': 'https://api.spotify.com/v1/users/g051x7db', 'id': 'g051x7db', 'type': 'user', 'uri': 'spotify:user:g051x7db'}, 'is_local': False, 'track': {'album': {'album_type': 'album', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/7Ln80lUS6He07XvHI8qqHH'}, 'href': 'https://api.spotify.com/v1/artists/7Ln80lUS6He07XvHI8qqHH', 'id': '7Ln80lUS6He07XvHI8qqHH', 'name': 'Arctic Monkeys', 'type': 'artist', 'uri': 'spotify:artist:7Ln80lUS6He07XvHI8qqHH'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'external_urls': {'spotify': 'https://open.spotify.com/album/1XkGORuUX2QGOEIL4EbJKm'}, 'href': 'https://api.spotify.com/v1/albums/1XkGORuUX2QGOEIL4EbJKm', 'id': '1XkGORuUX2QGOEIL4EbJKm', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/637c657bc3053d9f5fecad1c9ae68e20d8ab2eb6', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/b370274ac9b00a04c502f401b34bf577764f4c4f', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/660b217e14669a23e1d70273d0150f6828b1cb3f', 'width': 64}], 'name': 'Favourite Worst Nightmare', 'type': 'album', 'uri': 'spotify:album:1XkGORuUX2QGOEIL4EbJKm'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/7Ln80lUS6He07XvHI8qqHH'}, 'href': 'https://api.spotify.com/v1/artists/7Ln80lUS6He07XvHI8qqHH', 'id': '7Ln80lUS6He07XvHI8qqHH', 'name': 'Arctic Monkeys', 'type': 'artist', 'uri': 'spotify:artist:7Ln80lUS6He07XvHI8qqHH'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'disc_number': 1, 'duration_ms': 183893, 'explicit': False, 'external_ids': {'isrc': 'GBCEL0700067'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/2x8evxqUlF0eRabbW2JBJd'}, 'href': 'https://api.spotify.com/v1/tracks/2x8evxqUlF0eRabbW2JBJd', 'id': '2x8evxqUlF0eRabbW2JBJd', 'name': 'Fluorescent Adolescent', 'popularity': 80, 'preview_url': 'https://p.scdn.co/mp3-preview/cb8560b45aa0d4028e94a2648686c460641074d0?cid=3dab3c84034247168f7021f1f1128754', 'track_number': 5, 'type': 'track', 'uri': 'spotify:track:2x8evxqUlF0eRabbW2JBJd'}}, {'added_at': '2018-02-02T15:42:39Z', 'added_by': {'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db'}, 'href': 'https://api.spotify.com/v1/users/g051x7db', 'id': 'g051x7db', 'type': 'user', 'uri': 'spotify:user:g051x7db'}, 'is_local': False, 'track': {'album': {'album_type': 'album', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/0SfsnGyD8FpIN4U4WCkBZ5'}, 'href': 'https://api.spotify.com/v1/artists/0SfsnGyD8FpIN4U4WCkBZ5', 'id': '0SfsnGyD8FpIN4U4WCkBZ5', 'name': 'Armin van Buuren', 'type': 'artist', 'uri': 'spotify:artist:0SfsnGyD8FpIN4U4WCkBZ5'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'external_urls': {'spotify': 'https://open.spotify.com/album/0P0UYHedjYpAMpDZy3Lxk1'}, 'href': 'https://api.spotify.com/v1/albums/0P0UYHedjYpAMpDZy3Lxk1', 'id': '0P0UYHedjYpAMpDZy3Lxk1', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/9aca103482a3985c1e50d3d36e4cde1c98aa20cf', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/4b6fdbd853a858c53db031c1ddb79f07d7774f6e', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/09a3625136a9a32b70b7a322c8eb982874af2fd8', 'width': 64}], 'name': 'A State Of Trance Year Mix 2017 (Mixed by Armin van Buuren)', 'type': 'album', 'uri': 'spotify:album:0P0UYHedjYpAMpDZy3Lxk1'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/5B9q1NRokzWYB7nSgnlHyv'}, 'href': 'https://api.spotify.com/v1/artists/5B9q1NRokzWYB7nSgnlHyv', 'id': '5B9q1NRokzWYB7nSgnlHyv', 'name': 'Giuseppe Ottaviani', 'type': 'artist', 'uri': 'spotify:artist:5B9q1NRokzWYB7nSgnlHyv'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'disc_number': 2, 'duration_ms': 194344, 'explicit': False, 'external_ids': {'isrc': 'NLF711711719'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/4cnckyCmxL79byCK2wCI3f'}, 'href': 'https://api.spotify.com/v1/tracks/4cnckyCmxL79byCK2wCI3f', 'id': '4cnckyCmxL79byCK2wCI3f', 'name': 'Lumina', 'popularity': 44, 'preview_url': 'https://p.scdn.co/mp3-preview/71d43597c080253c62cc7690449a7a473ba0c57f?cid=3dab3c84034247168f7021f1f1128754', 'track_number': 78, 'type': 'track', 'uri': 'spotify:track:4cnckyCmxL79byCK2wCI3f'}}], 'limit': 100, 'next': None, 'offset': 0, 'previous': None, 'total': 3}, 'type': 'playlist', 'uri': 'spotify:user:g051x7db:playlist:3UVCafpPe8O9Nn47A6D363'}
    m.next.return_value = None
    m.artists.return_value = {'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/1XKjtpH5P81gpOXDB91IEB'}, 'followers': {'href': None, 'total': 168655}, 'genres': ['deep german hip hop'], 'href': 'https://api.spotify.com/v1/artists/1XKjtpH5P81gpOXDB91IEB', 'id': '1XKjtpH5P81gpOXDB91IEB', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/2b07998f4b60731056fe325c79386f5c2ce5cd00', 'width': 640}, {'height': 320, 'url': 'https://i.scdn.co/image/d87d745e975ac979c23b0524928828c585d3303e', 'width': 320}, {'height': 160, 'url': 'https://i.scdn.co/image/27697724dce51810319f472962a70674067e161f', 'width': 160}], 'name': 'Miami Yacine', 'popularity': 72, 'type': 'artist', 'uri': 'spotify:artist:1XKjtpH5P81gpOXDB91IEB'}, {'external_urls': {'spotify': 'https://open.spotify.com/artist/7Ln80lUS6He07XvHI8qqHH'}, 'followers': {'href': None, 'total': 4938610}, 'genres': ['garage rock', 'indie rock', 'modern rock', 'permanent wave', 'sheffield indie'], 'href': 'https://api.spotify.com/v1/artists/7Ln80lUS6He07XvHI8qqHH', 'id': '7Ln80lUS6He07XvHI8qqHH', 'images': [{'height': 1333, 'url': 'https://i.scdn.co/image/c488bf987b2f716a539a768a102855450345113d', 'width': 1000}, {'height': 853, 'url': 'https://i.scdn.co/image/b30c0e39cfa70b2124b9d0d24e83761ef48e5540', 'width': 640}, {'height': 267, 'url': 'https://i.scdn.co/image/e1f00ceabce8dd0480bad7e873993082d9ac3fe9', 'width': 200}, {'height': 85, 'url': 'https://i.scdn.co/image/eba02729ec372fd9954cafd3fd71950bb8fc385f', 'width': 64}], 'name': 'Arctic Monkeys', 'popularity': 85, 'type': 'artist', 'uri': 'spotify:artist:7Ln80lUS6He07XvHI8qqHH'}, {'external_urls': {'spotify': 'https://open.spotify.com/artist/5B9q1NRokzWYB7nSgnlHyv'}, 'followers': {'href': None, 'total': 22068}, 'genres': ['deep uplifting trance', 'edm', 'progressive house', 'progressive trance', 'trance', 'uplifting trance'], 'href': 'https://api.spotify.com/v1/artists/5B9q1NRokzWYB7nSgnlHyv', 'id': '5B9q1NRokzWYB7nSgnlHyv', 'images': [{'height': 1000, 'url': 'https://i.scdn.co/image/71f3f50192efe45992a542d3dca9888957b8d647', 'width': 1000}, {'height': 640, 'url': 'https://i.scdn.co/image/4f2ca00f94641cc466fde8e67bfed36fcec344e1', 'width': 640}, {'height': 200, 'url': 'https://i.scdn.co/image/e6ced34336070d14d3fbb2b8c81e7121033e5fb3', 'width': 200}, {'height': 64, 'url': 'https://i.scdn.co/image/081aa8fd80e374b0e3446d98d8c32236f7902003', 'width': 64}], 'name': 'Giuseppe Ottaviani', 'popularity': 52, 'type': 'artist', 'uri': 'spotify:artist:5B9q1NRokzWYB7nSgnlHyv'}]}
    return m


@pytest.fixture()
def fetcher(spotipyAPI):
    return fetch.Fetcher("spotify:user:g051x7db:playlist:3UVCafpPe8O9Nn47A6D363", spotipyAPI)


def test_fetch_playlist(fetcher):
    assert fetcher.fetch_playlist() == {'href': 'https://api.spotify.com/v1/users/g051x7db/playlists/3UVCafpPe8O9Nn47A6D363/tracks?offset=0&limit=100', 'items': [{'added_at': '2018-02-02T15:42:29Z', 'added_by': {'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db'}, 'href': 'https://api.spotify.com/v1/users/g051x7db', 'id': 'g051x7db', 'type': 'user', 'uri': 'spotify:user:g051x7db'}, 'is_local': False, 'track': {'album': {'album_type': 'single', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/1XKjtpH5P81gpOXDB91IEB'}, 'href': 'https://api.spotify.com/v1/artists/1XKjtpH5P81gpOXDB91IEB', 'id': '1XKjtpH5P81gpOXDB91IEB', 'name': 'Miami Yacine', 'type': 'artist', 'uri': 'spotify:artist:1XKjtpH5P81gpOXDB91IEB'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'external_urls': {'spotify': 'https://open.spotify.com/album/40CYJrASNrMCDr2x4UE60E'}, 'href': 'https://api.spotify.com/v1/albums/40CYJrASNrMCDr2x4UE60E', 'id': '40CYJrASNrMCDr2x4UE60E', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/bf3561a432a4ceac784c5f9dfd551c0de4d29a94', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/ee3625453f33e989380a67d0a25299840fdcde8a', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/93b12946028a5a172008f5c2f25e2dcd3bc61e48', 'width': 64}], 'name': 'Kokaina', 'type': 'album', 'uri': 'spotify:album:40CYJrASNrMCDr2x4UE60E'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/1XKjtpH5P81gpOXDB91IEB'}, 'href': 'https://api.spotify.com/v1/artists/1XKjtpH5P81gpOXDB91IEB', 'id': '1XKjtpH5P81gpOXDB91IEB', 'name': 'Miami Yacine', 'type': 'artist', 'uri': 'spotify:artist:1XKjtpH5P81gpOXDB91IEB'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'disc_number': 1, 'duration_ms': 201979, 'explicit': True, 'external_ids': {'isrc': 'DELJ81616750'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/2KHbPYI22yWIOgWUsApYIS'}, 'href': 'https://api.spotify.com/v1/tracks/2KHbPYI22yWIOgWUsApYIS', 'id': '2KHbPYI22yWIOgWUsApYIS', 'name': 'Kokaina', 'popularity': 68, 'preview_url': 'https://p.scdn.co/mp3-preview/f06860acc59525ee6758536914c7b07001f1470d?cid=3dab3c84034247168f7021f1f1128754', 'track_number': 1, 'type': 'track', 'uri': 'spotify:track:2KHbPYI22yWIOgWUsApYIS'}}, {'added_at': '2018-02-02T15:42:33Z', 'added_by': {'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db'}, 'href': 'https://api.spotify.com/v1/users/g051x7db', 'id': 'g051x7db', 'type': 'user', 'uri': 'spotify:user:g051x7db'}, 'is_local': False, 'track': {'album': {'album_type': 'album', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/7Ln80lUS6He07XvHI8qqHH'}, 'href': 'https://api.spotify.com/v1/artists/7Ln80lUS6He07XvHI8qqHH', 'id': '7Ln80lUS6He07XvHI8qqHH', 'name': 'Arctic Monkeys', 'type': 'artist', 'uri': 'spotify:artist:7Ln80lUS6He07XvHI8qqHH'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'external_urls': {'spotify': 'https://open.spotify.com/album/1XkGORuUX2QGOEIL4EbJKm'}, 'href': 'https://api.spotify.com/v1/albums/1XkGORuUX2QGOEIL4EbJKm', 'id': '1XkGORuUX2QGOEIL4EbJKm', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/637c657bc3053d9f5fecad1c9ae68e20d8ab2eb6', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/b370274ac9b00a04c502f401b34bf577764f4c4f', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/660b217e14669a23e1d70273d0150f6828b1cb3f', 'width': 64}], 'name': 'Favourite Worst Nightmare', 'type': 'album', 'uri': 'spotify:album:1XkGORuUX2QGOEIL4EbJKm'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/7Ln80lUS6He07XvHI8qqHH'}, 'href': 'https://api.spotify.com/v1/artists/7Ln80lUS6He07XvHI8qqHH', 'id': '7Ln80lUS6He07XvHI8qqHH', 'name': 'Arctic Monkeys', 'type': 'artist', 'uri': 'spotify:artist:7Ln80lUS6He07XvHI8qqHH'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'disc_number': 1, 'duration_ms': 183893, 'explicit': False, 'external_ids': {'isrc': 'GBCEL0700067'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/2x8evxqUlF0eRabbW2JBJd'}, 'href': 'https://api.spotify.com/v1/tracks/2x8evxqUlF0eRabbW2JBJd', 'id': '2x8evxqUlF0eRabbW2JBJd', 'name': 'Fluorescent Adolescent', 'popularity': 80, 'preview_url': 'https://p.scdn.co/mp3-preview/cb8560b45aa0d4028e94a2648686c460641074d0?cid=3dab3c84034247168f7021f1f1128754', 'track_number': 5, 'type': 'track', 'uri': 'spotify:track:2x8evxqUlF0eRabbW2JBJd'}}, {'added_at': '2018-02-02T15:42:39Z', 'added_by': {'external_urls': {'spotify': 'https://open.spotify.com/user/g051x7db'}, 'href': 'https://api.spotify.com/v1/users/g051x7db', 'id': 'g051x7db', 'type': 'user', 'uri': 'spotify:user:g051x7db'}, 'is_local': False, 'track': {'album': {'album_type': 'album', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/0SfsnGyD8FpIN4U4WCkBZ5'}, 'href': 'https://api.spotify.com/v1/artists/0SfsnGyD8FpIN4U4WCkBZ5', 'id': '0SfsnGyD8FpIN4U4WCkBZ5', 'name': 'Armin van Buuren', 'type': 'artist', 'uri': 'spotify:artist:0SfsnGyD8FpIN4U4WCkBZ5'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'external_urls': {'spotify': 'https://open.spotify.com/album/0P0UYHedjYpAMpDZy3Lxk1'}, 'href': 'https://api.spotify.com/v1/albums/0P0UYHedjYpAMpDZy3Lxk1', 'id': '0P0UYHedjYpAMpDZy3Lxk1', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/9aca103482a3985c1e50d3d36e4cde1c98aa20cf', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/4b6fdbd853a858c53db031c1ddb79f07d7774f6e', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/09a3625136a9a32b70b7a322c8eb982874af2fd8', 'width': 64}], 'name': 'A State Of Trance Year Mix 2017 (Mixed by Armin van Buuren)', 'type': 'album', 'uri': 'spotify:album:0P0UYHedjYpAMpDZy3Lxk1'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/5B9q1NRokzWYB7nSgnlHyv'}, 'href': 'https://api.spotify.com/v1/artists/5B9q1NRokzWYB7nSgnlHyv', 'id': '5B9q1NRokzWYB7nSgnlHyv', 'name': 'Giuseppe Ottaviani', 'type': 'artist', 'uri': 'spotify:artist:5B9q1NRokzWYB7nSgnlHyv'}], 'available_markets': ['AD', 'AR', 'AT', 'AU', 'BE', 'BG', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'EC', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IS', 'IT', 'JP', 'LI', 'LT', 'LU', 'LV', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'PA', 'PE', 'PH', 'PL', 'PT', 'PY', 'SE', 'SG', 'SK', 'SV', 'TH', 'TR', 'TW', 'US', 'UY'], 'disc_number': 2, 'duration_ms': 194344, 'explicit': False, 'external_ids': {'isrc': 'NLF711711719'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/4cnckyCmxL79byCK2wCI3f'}, 'href': 'https://api.spotify.com/v1/tracks/4cnckyCmxL79byCK2wCI3f', 'id': '4cnckyCmxL79byCK2wCI3f', 'name': 'Lumina', 'popularity': 44, 'preview_url': 'https://p.scdn.co/mp3-preview/71d43597c080253c62cc7690449a7a473ba0c57f?cid=3dab3c84034247168f7021f1f1128754', 'track_number': 78, 'type': 'track', 'uri': 'spotify:track:4cnckyCmxL79byCK2wCI3f'}}], 'limit': 100, 'next': None, 'offset': 0, 'previous': None, 'total': 3} 


def test_get_genres(fetcher, spotipyAPI):
    assert fetcher.get_genres_from_playlist(spotipyAPI.user_playlist()["tracks"]) == [['deep german hip hop'], ['garage rock', 'indie rock', 'modern rock', 'permanent wave', 'sheffield indie'], ['deep uplifting trance', 'edm', 'progressive house', 'progressive trance', 'trance', 'uplifting trance']]


@pytest.mark.parametrize("test_input, expected", [
    ([["pop", "trance"],["rock", "mellow trap"],["hip hop", "hip hip hop"]],{"pop": 1, "trance": 1, "rock": 1, "mellow trap": 1, "hip hop": 1, "hip hip hop": 1}),
    ([["pop"], ["pop"], ["pop"], ["pop"]], {"pop":4}),
    ([["trap"]], {"trap": 1})
])
def test_quantize_genres(fetcher, test_input, expected):
    assert fetcher.quantize_genres(test_input) == expected
